<!DOCTYPE html>
<html>
	<head>
		<title>Checklist Tool v3</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	</head>
	<body>
		<div id="outputDiv"></div>
		
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<script>
			var checklistDB = {
				"N64079 - C-172P": {
					// Checklists for a Cessna 172P Skyhawk
					// With additions by Mike Marquette, owner of N64079

					"PREFLIGHT": [
						{ "type": "title", "text": "(1) CABIN" },
						{ "type": "cki", "text": "1. Pilot's Operating Handbook -- AVAILABLE IN THE AIRPLANE" },
						{ "type": "cki", "text": "2. Parking Brake -- SET" },
						{ "type": "cki", "text": "3. Control Wheel Lock -- REMOVE" },
						{ "type": "cki", "text": "4. Ignition Switch -- OFF" },
						{ "type": "cki", "text": "5. Avionics Power Switch -- OFF" },
						{ "type": "cki", "text": "6. Master Switch -- ON" },
						{ "type": "cki", "text": "7. Fuel Quantity Indicators -- CHECK QUANTITY" },
						{ "type": "cki", "text": "8. Avionics Cooling Fan -- CHECK AUDIBLY FOR OPERATION" },
						{ "type": "cki", "text": "8a. Flaps -- FULLY LOWER" },
						{ "type": "cki", "text": "9. Master Switch -- OFF" },
						{ "type": "cki", "text": "10. Static Pressure Alternate Source Valve (if installed) -- OFF" },
						{ "type": "cki", "text": "11. Fuel Selector Valve -- BOTH" },
						{ "type": "cki", "text": "12. Baggage Door -- CHECK, lock with key if child's seat is to be occupied." },

						{ "type": "title", "text": "(2) EMPENNAGE" },
						{ "type": "cki", "text": "1. Rudder Gust Lock -- REMOVE" },
						{ "type": "cki", "text": "2. Tail Tie-Down -- DISCONNECT" },
						{ "type": "cki", "text": "3. Control Surfaces -- CHECK freedom of movement and security." },

						{ "type": "title", "text": "(3) RIGHT WING Trailing Edge" },
						{ "type": "cki", "text": "1. Aileron -- CHECK freedom of movement and security." },

						{ "type": "title", "text": "(4) RIGHT WING" },
						{ "type": "cki", "text": "1. Wing Tie-Down -- DISCONNECT." },
						{ "type": "cki", "text": "2. Main Wheel Tire -- CHECK for proper inflation." },
						{ "type": "cki", "text": "3. Fuel Tank Sump Quick-Drain Valve -- DRAIN fuel and check" },
						{ "type": "cki", "text": "4. Fuel Selector Quick-Drain Valve -- DRAIN fuel and check" },
						{ "type": "cki", "text": "5. Fuel Quantity -- CHECK VISUALLY for desired level." },
						{ "type": "cki", "text": "6. Fuel Filler Cap -- SECURE." },

						{ "type": "title", "text": "(5) NOSE" },
						{ "type": "cki", "text": "1. Engine Oil Dipstick/Filler Cap -- CHECK oil level, then SECURE cap." },
						{ "type": "cki", "text": "2. Fuel Strainer Drain Knob -- PULL OUT, check, then CLOSE" },
						{ "type": "cki", "text": "3. Propeller and Spinner -- CHECK for nicks and security." },
						{ "type": "cki", "text": "4. Carburetor Air Filter -- CHECK for restrictions by dust or other foreign matter." },
						{ "type": "cki", "text": "5. Nose Wheel Strut and Tire -- CHECK for proper inflation." },
						{ "type": "cki", "text": "6. Nose Tie-Down -- DISCONNECT." },
						{ "type": "cki", "text": "7. Static Source Opening (left side of fuselage) -- CHECK for stoppage." },

						{ "type": "title", "text": "(6) LEFT WING" },
						{ "type": "cki", "text": "1. Main Wheel Tire -- CHECK for proper inflation." },
						{ "type": "cki", "text": "2. Fuel Tank Sump Quick-Drain Valve -- DRAIN fuel and check" },
						{ "type": "cki", "text": "3. Fuel Quantity -- CHECK VISUALLY for desired level." },
						{ "type": "cki", "text": "4. Fuel Filler Cap -- SECURE." },

						{ "type": "title", "text": "(7) LEFT WING Leading Edge" },
						{ "type": "cki", "text": "1. Pitot Tube Cover -- REMOVE and check opening for stoppage." },
						{ "type": "cki", "text": "2. Fuel Tank Vent Opening -- CHECK for stoppage." },
						{ "type": "cki", "text": "3. Stall Warning Opening -- CHECK for stoppage" },
						{ "type": "cki", "text": "4. Wing Tie-Down -- DISCONNECT." },
						{ "type": "cki", "text": "5. Landing Light(s) -- CHECK for condition and cleanliness of cover." },

						{ "type": "title", "text": "(8) LEFT WING Trailing Edge" },
						{ "type": "cki", "text": "1. Aileron -- CHECK for freedom of movement and security." },

						{ "type": "title", "text": "(9) PERSONAL Additions" },
						{ "type": "cki", "text": "1. Fuel testers -- CHECK that they are not on engine cowling" }

					], // End of N64079 "PRE-FLIGHT" checklist
					"ENGINE SHUTDOWN": [
						{ "type": "title", "text": "(1) SHUTDOWN PROCEDURE" },
						{ "type": "cki", "text": "1. S - Switches -- OFF" },
						{ "type": "cki", "text": "2. L - Lean Mixture -- MAX LEAN" },
						{ "type": "cki", "text": "3. I - Ignition -- OFF" },
						{ "type": "cki", "text": "4. M - Master Switch -- OFF" },
						{ "type": "cki", "text": "5. G - Gustlock -- INSTALLED" }
					] // End of N64079 "ENGINE SHUTDOWN" checklist
				}, // End of N64079 associative array of checklists

				"N8256X - PA-28-181": {
					// Checklists for a Piper PA-28-181 Archer
					// Owned by Skyriders

					"PREFLIGHT": [
						{ "type": "title", "text": "CABIN" },
						{ "type": "cki", "text": "Pilot's Operating Handbook -- AVAILABLE IN THE AIRPLANE" },
						{ "type": "cki", "text": "Required papers -- ON BOARD" },
						{ "type": "cki", "text": "Control wheel -- RELEASE BELTS" },
						{ "type": "cki", "text": "Master switch -- ON" },
						{ "type": "cki", "text": "Fuel quantity gauges -- CHECK" },
						{ "type": "cki", "text": "Master switch -- OFF" },
						{ "type": "cki", "text": "Ignition -- OFF" },

						{ "type": "title", "text": "RIGHT WING" },
						{ "type": "cki", "text": "Exterior -- CHECK FOR DAMAGE" },
						{ "type": "cki", "text": "Exterior -- FREE OF ICE, SNOW, FROST" },
						{ "type": "cki", "text": "Control surfaces -- CHECK FOR INTERFERENCE - FREE OF ICE, SNOW, FROST" },
						{ "type": "cki", "text": "Control locks -- STOW" },
						{ "type": "cki", "text": "Hinges -- CHECK FOR INTERFERENCE" },
						{ "type": "cki", "text": "Stall warning -- CHECK" },
						{ "type": "cki", "text": "Navigation lights -- CHECK FOR INTERFERENCE" },
						{ "type": "cki", "text": "Fuel tank -- CHECK SUPPLY VISUALLY - SECURE CAP" },
						{ "type": "cki", "text": "Fuel tank sump -- DRAIN" },
						{ "type": "cki", "text": "Main gear strut -- PROPER INFLATION (4.50 in.)" },
						{ "type": "cki", "text": "Tire -- CHECK" },
						{ "type": "cki", "text": "Brake blocks -- CHECK" },
						{ "type": "cki", "text": "Pitot head -- REMOVE COVER - HOLES CLEAR" },

						{ "type": "title", "text": "FRONT" },
						{ "type": "cki", "text": "Windshield -- CLEAN" },
						{ "type": "cki", "text": "Propeller and spinner -- CHECK" },
						{ "type": "cki", "text": "Fuel and oil -- CHECK FOR LEAKS" },
						{ "type": "cki", "text": "Oil -- CHECK LEVEL" },
						{ "type": "cki", "text": "Dipstick -- PROPERLY SEATED" },
						{ "type": "cki", "text": "Cowling -- SECURE" },
						{ "type": "cki", "text": "Inspection covers -- SECURE" },
						{ "type": "cki", "text": "Nose wheel tire -- CHECK" },
						{ "type": "cki", "text": "Nose wheel strut -- PROPER INFLATION (3.25 in.)" },
						{ "type": "cki", "text": "Air inlets -- CLEAR" },
						{ "type": "cki", "text": "Alternator belt -- CHECK TENSION" },
						{ "type": "cki", "text": "Towbar -- STOW" },
						{ "type": "cki", "text": "Fuel strainer -- DRAIN" },


						{ "type": "title", "text": "LEFT WING" },
						{ "type": "cki", "text": "Exterior -- CHECK FOR DAMAGE" },
						{ "type": "cki", "text": "Exterior -- FREE OF ICE, SNOW, FROST" },
						{ "type": "cki", "text": "Control surfaces -- CHECK FOR INTERFERENCE - FREE OF ICE, SNOW, FROST" },
						{ "type": "cki", "text": "Control locks -- STOW" },
						{ "type": "cki", "text": "Hinges -- CHECK FOR INTERFERENCE" },
						{ "type": "cki", "text": "Stall warning -- CHECK" },
						{ "type": "cki", "text": "Navigation lights -- CHECK FOR INTERFERENCE" },
						{ "type": "cki", "text": "Fuel tank -- CHECK SUPPLY VISUALLY - SECURE CAP" },
						{ "type": "cki", "text": "Fuel tank sump -- DRAIN" },
						{ "type": "cki", "text": "Main gear strut -- PROPER INFLATION (4.50 in.)" },
						{ "type": "cki", "text": "Tire -- CHECK" },
						{ "type": "cki", "text": "Brake blocks -- CHECK" },
						{ "type": "cki", "text": "Pitot head -- REMOVE COVER - HOLES CLEAR" },

						{ "type": "title", "text": "EMPENNAGE" },
						{ "type": "cki", "text": "Baggage -- STOWED PROPERLY - SECURE" },
						{ "type": "cki", "text": "Baggage door -- CLOSE AND SECURE" },

						{ "type": "title", "text": "TAIL" },
						{ "type": "cki", "text": "Exterior -- CHECK FOR DAMAGE" },
						{ "type": "cki", "text": "Exterior -- FREE OF ICE, SNOW, FROST" },
						{ "type": "cki", "text": "Control surfaces -- CHECK FOR INTERFERENCE - FREE OF ICE, SNOW, FROST" },
						{ "type": "cki", "text": "Control locks -- STOW" },
						{ "type": "cki", "text": "Hinges -- CHECK FOR INTERFERENCE" },
						{ "type": "cki", "text": "Navigation lights -- CHECK FOR INTERFERENCE" },

						{ "type": "title", "text": "CABIN - Part 2" },
						{ "type": "cki", "text": "Primary flight controls -- PROPER OPERATION" },
						{ "type": "cki", "text": "Seat belts and harnesses -- FASTENED - CHECK INERTIA REEL" },
					], // End of N8256X "PRE-FLIGHT" checklist
				}, // End of N8256X associative array of checklists
			};
		</script>

		<script>
			class MainApp {
				constructor(anAnchorElement, aCheckListDB) {
					this.appVersion = 3;

					this.anchorElement = anAnchorElement;
					this.checklistDB = aCheckListDB;
					this.currentAircraft = '';
					this.currentChecklist = '';

					this.runStep = 0;
				}

				clearAppWindow() {
					$(this.anchorElement).empty();
				}

				draw() {
					// console.log("Starting MainApp.draw()...");
					this.clearAppWindow();

					this.titleNav = new TitleNav(this.anchorElement, this);
					this.titleNav.draw();

					if (this.runStep === 0) {
						// Need to get the currentAircraft
						// console.log("Starting MainApp.draw--if(runStep === 0)...");
						this.optionGetter = new OptionGetter(this.anchorElement, this, this.checklistDB);
						this.optionGetter.draw();
					}
					else if (this.runStep === 1) {
						// Need to get the currentChecklist
						// console.log("Starting MainApp.draw--if(runStep === 1)...");
						this.optionGetter = new OptionGetter(this.anchorElement, this, this.checklistDB[this.currentAircraft]);
						this.optionGetter.draw();
					}
					else if (this.runStep === 2) {
						// Need to show the checklist
						this.checklistRunner = new ChecklistRunner(this.anchorElement, this, this.checklistDB[this.currentAircraft][this.currentChecklist]);
						this.checklistRunner.draw();
					}
				}

				processResult(aResult="") {
					if (this.runStep === 0) {
						this.currentAircraft = aResult;
						this.runStep++;
						this.draw();
					}
					else if (this.runStep === 1) {
						this.currentChecklist = aResult;
						this.runStep++;
						this.draw();
					}
					else if (this.runStep === 2) {

						this.titleNav.updateProgressDiv();
					}
				}
			}

			class TitleNav {
				constructor(anAnchorElement, aParentObject) {
					this.anchorElement = anAnchorElement;
					this.parentObject = aParentObject;

					this.appTitleDiv = '';
					this.currentAircraftDiv = '';
					this.currentChecklistDiv = '';
					this.progressDiv = '';
				}

				draw() {
					// console.log("Starting TitleNav.draw()...");
					// Make a Navbar
					this.navElement = createDOMElement({
						"ELtype": "nav",
						"ELclasses": [ "navbar", "fixed-top", "navbar-dark", "bg-primary" ],
						"ELattributes": [
							{ "ELname": "id", "ELvalue": "navElement" }
						],
						"ELparentElement": this.anchorElement
					});

					// Make a title
					this.appTitleDiv = createDOMElement({
						"ELtype": "div",
						"ELclasses": [ "navbar-brand" ],
						"ELattributes": [
							{ "ELname": "id", "ELvalue": "appTitleDiv" }
						],
						"ELparentElement": this.navElement
					});

					// Display the current aircraft as this.parentObject.currentAircraft || "None selected"
					var aircraftDisplayText = "Aircraft: None selected";
					if (this.parentObject.currentAircraft !== '') {
						aircraftDisplayText = "Aircraft: " + this.parentObject.currentAircraft;
					}

					this.currentAircraftDiv = createDOMElement({
						"ELtype": "span",
						"ELattributes": [
							{ "ELname": "id", "ELvalue": "currentAircraftDiv" }
						],
						"ELhtmlString": aircraftDisplayText,
						"ELparentElement": this.appTitleDiv
					});

					// Create a DIV for this.currentChecklist
					var checklistDisplayText = "Checklist: None selected";
					if (this.parentObject.runStep >= 1) {
						checklistDisplayText = "Checklist: " + this.parentObject.currentChecklist;
					}

					this.currentChecklistDiv = createDOMElement({
						"ELtype": "div",
						"ELattributes": [
							{ "ELname": "id", "ELvalue": "currentChecklistDiv" }
						],
						"ELhtmlString": checklistDisplayText,
						"ELparentElement": this.appTitleDiv
					});

					// Create a DIV for this.progressDiv
					if (this.parentObject.runStep >= 2) {
						this.progressDiv = createDOMElement({
							"ELtype": "div",
							"ELattributes": [
								{ "ELname": "id", "ELvalue": "progressDiv" }
							],
							"ELhtmlString": "Progress: 0%",
							"ELparentElement": this.appTitleDiv
						});
					}
				}

				updateProgressDiv() {
					// console.log("Starting TitleNav.updateProgressDiv()...");
					if (this.parentObject.runStep >= 2) {
						var totalButtons = document.getElementsByClassName("cki").length;
						var greenButtons = document.getElementsByClassName("btn-success").length;
						var percentComplete = Math.round(greenButtons / totalButtons * 100);

						console.log("   totalButtons = " + totalButtons);
						console.log("   greenButtons = " + greenButtons);
						console.log("   percentComplete = " + percentComplete);

						this.progressDiv.innerHTML = "Progress: " + percentComplete + "%";
					}
				}
			}

			class OptionGetter {
				constructor(anAnchorElement, aParentObject, aChoiceObject) {
					this.anchorElement = anAnchorElement;
					this.parentObject = aParentObject;
					this.choiceObject = aChoiceObject;
				}

				draw() {
					// console.log("Starting OptionGetter.draw()...");

					var choiceContainer = createDOMElement({
						"ELtype": "div",
						"ELclasses": [ "container", "d-flex", "flex-column" ],
						"ELattributes": [
							{ "ELname": "style", "ELvalue": "margin-top: 120px" }
						],
						"ELparentElement": this.anchorElement
					});

					var thisObject = this;
					var choiceArray = Object.keys(this.choiceObject);
					choiceArray.sort();
					// console.log("choiceArray = " + JSON.stringify(choiceArray));
					// console.log("ChoiceArray.length = " + choiceArray.length);
					for (var i = 0; i < choiceArray.length; i++) {
						// console.log("Making a button...");
						var newButton = createDOMElement({
							"ELtype": "button",
							"ELclasses": [ "btn", "btn-info", "m-1" ],
							"ELattributes": [
								{ "ELname": "id", "ELvalue": choiceArray[i] }
							],
							"ELhtmlString": choiceArray[i],
							"ELparentElement": choiceContainer
						});
						newButton.addEventListener("click", function(e) {
							thisObject.parentObject.processResult(e.target.id);
						});
					}
				}
			}

			class ChecklistRunner {
				constructor(anAnchorElement, aParentObject, aChecklistArray) {
					this.anchorElement = anAnchorElement;
					this.parentObject = aParentObject;
					this.checklistArray = aChecklistArray;
				}

				draw() {
					// console.log("Starting ChecklistRunner.draw()...");

					var checklistContainer = createDOMElement({
						"ELtype": "div",
						"ELclasses": [ "container", "d-flex", "flex-column", "pb-3" ],
						"ELattributes": [
							{ "ELname": "style", "ELvalue": "margin-top: 120px" }
						],
						"ELparentElement": this.anchorElement
					});

					for (var i = 0; i < this.checklistArray.length; i++) {
						var newCKI = new CKI(checklistContainer, this, this.checklistArray[i].type, this.checklistArray[i].text, i);
						newCKI.draw();
					}
				}

				processResult() {
					this.parentObject.processResult();
				}
			}

			class CKI {
				constructor(aParentElement, aParentObject, anEntryType, aDisplayText, anID) {
					this.anchorElement = aParentElement;
					this.parentObject = aParentObject;
					this.entryType = anEntryType;
					this.displayText = aDisplayText;
					this.myID = anID;

					this.mylatesttap = 0;
					this.myElement = 0;
					this.created = false;
				}
				
				draw() {
					var thisObject = this; // For when this is needed later on in this method
					var ckiElement = "";
					
					if (this.entryType === "title") {
						ckiElement = createDOMElement({
							"ELtype": "div",
							"ELclasses": [ "card", "mt-3" ],
							"ELparentElement": this.anchorElement
						});

						var ckiHeading = createDOMElement({
							"ELtype": "h5",
							"ELclasses": [ "card-header" ],
							"ELhtmlString": this.displayText,
							"ELparentElement": ckiElement
						});
					}
					else {
						ckiElement = createDOMElement({
							"ELtype": "button",
							"ELclasses": [ "btn", "btn-block", "btn-danger", "w-75", "mt-2", "ml-3", "cki" ],
							"ELattributes": [
								{ "ELname": "id", "ELvalue": "cki-" + this.myID }
							],
							"ELhtmlString": this.displayText,
							"ELparentElement": this.anchorElement
						});
						$(ckiElement).on("touchend click", function(event) {
							event.preventDefault();
							// thisObject.handleTap(thisObject.myID);
							thisObject.handleTap(event.target.id);
						});
					}
					
					this.myElement = ckiElement;
					this.created = true;
				}
				
				handleTap(anID) {
					// console.log("Starting handleTap()...");
					var now = new Date().getTime();
					var timesince = now - this.mylatesttap;
					
					if (this.mylatesttap == "beginning") {
						this.mylatesttap = new Date().getTime();
					}
					
					if ((timesince < 600) && (timesince > 0)) {
						// This object has been double-clicked or double-tapped
						//console.log("This was double-clicked or double-tapped: " + this.displayText);
						this.myElement.classList.remove('btn-danger');
						this.myElement.classList.add('btn-success');
						//$(this.myElement).on("touchend click", function() { var x="do nothing"; });
						$(this.myElement).off();
						
						// Now update the result
						// It's a global function in the HTML file
						this.processResult();
						// totalChecklistItemsCompleted++;
						// updateResult("result");
					}
					else {
						// Only single clicked or single tapped
					}
					
					this.mylatesttap = new Date().getTime();
				}

				processResult() {
					this.parentObject.processResult();
				}
			}


			//=================================================================================================
			//=================================================================================================
			//                                           Utility Functions
			//=================================================================================================
			//=================================================================================================


			// *********************************************************************
			// createDOMElement(elData)
			//
			// Requires an input JSON object (example below):
			//
			//  {
			//    "ELtype": "div",
			//    "ELclasses": [ "modal", "fade" ],
			//    "ELattributes": [
			//      { "ELname": "role", "ELvalue": "dialog" }
			//    ],
			//    "ELhtmlString": "Hello, world!",
			//    "ELparentElement": // a DOM element
			//  }
			//
			// *********************************************************************
			function createDOMElement(elData) {
				if ("ELtype" in elData) {
					var newElement = document.createElement(elData.ELtype);

					if ("ELclasses" in elData) {
					for (i = 0; i < elData.ELclasses.length; i++) {
						newElement.classList.add(elData.ELclasses[i]);
					}
					}

					if ("ELattributes" in elData) {
					for (i = 0; i < elData.ELattributes.length; i++) {
						newElement.setAttribute(elData.ELattributes[i].ELname, elData.ELattributes[i].ELvalue);
					}
					}

					if ("ELhtmlString" in elData) {
					newElement.innerHTML = elData.ELhtmlString;
					}

					if ("ELparentElement" in elData) {
					elData.ELparentElement.appendChild(newElement);
					}

					return newElement;
				}
				else {
					return -1;
				}
			}
		</script>

		<script>
			// Startup the app
			var mainApp = new MainApp(document.getElementById("outputDiv"), checklistDB);
			mainApp.draw();
		</script>

	</body>
</html>